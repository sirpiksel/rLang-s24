# TESTING IA

test_that("Basic Usage with Default Parameters", {
  set.seed(123)
  X <- rnorm(100)

  expected_nu <- c(0.8249005, 0.8243600, 0.8137623, 0.7966924, 0.7879659, 0.7876699, 0.7874711, 0.7858748, 0.7848336, 0.7805170, 0.7790732, 0.7718370, 0.7443690, 0.7297679, 0.7232089, 0.7215108, 0.7215075, 0.7184504, 0.7175052, 0.7161758, 0.7054336, 0.7013850, 0.6997835, 0.6951224, 0.6950742, 0.6947866, 0.6947738, 0.6689373, 0.6674017, 0.6659387, 0.6585404, 0.6556103, 0.6550534, 0.6549991, 0.6549903, 0.6429247, 0.6412470, 0.6260114, 0.6240807, 0.6213377, 0.6192416, 0.6139382, 0.6106320, 0.6049667, 0.5998362, 0.5955019, 0.5947273, 0.5943100, 0.5942940, 0.5941483, 0.5889611, 0.5793253, 0.5790544, 0.5773593, 0.5707873, 0.5690083, 0.5664318, 0.5612017, 0.5578876, 0.5574939, 0.5563744, 0.5556083, 0.5556077, 0.5515511, 0.5468182, 0.5446940, 0.5438698, 0.5436733, 0.5368120, 0.5332484, 0.5309258, 0.5208679, 0.5190260, 0.5190258, 0.5177302, 0.5176359, 0.5174704, 0.5174683, 0.5171138, 0.5160217, 0.5140151, 0.5127751, 0.5124650, 0.5123317, 0.5123280, 0.5123131, 0.5120400, 0.5118540, 0.5097440, 0.5091709, 0.5090452, 0.5088257, 0.5076506, 0.5060624, 0.5052514, 0.5052446, 0.5013104, 0.5012867, 0.5012833, 0.4979565)

  expected_coeffs <- c(0.077761985, -0.083173544, 0.097914982, -0.181342325, 0.049198785, 0.034279188, 0.010777677, -0.086303806, -0.028017420, -0.036051456, -0.013916840, -0.169079294, -0.115098260, 0.103059537, -0.130072580, 0.024796811, 0.162661639, -0.138568498, -0.012313025, -0.055154191, 0.057241615, 0.082870862, -0.157867042, 0.105083171, 0.048212635, -0.097504077, -0.124880791, 0.130717352, -0.036303637, -0.116537925, 0.092941624, -0.041735016, -0.002055763, -0.005133371, -0.021443057, -0.122754786, 0.111013386, 0.013209334, 0.176018999, -0.070251181, -0.003138291, 0.090056696, 0.057757028, -0.113312364, -0.042997851, 0.008025368, -0.055174648, 0.003507653, -0.010095779, -0.032862008, 0.012294498, -0.026230916, 0.136855663, 0.119566419, -0.016210406, -0.026764704, 0.083876758, -0.062079246, -0.049504623, 0.053362984, -0.125150882, -0.053831261, 0.115122063, 0.043396604, -0.053215401, -0.102720650, 0.005448317, -0.037230326, -0.170178362, 0.032062648, 0.006101200, -0.121565339, -0.016663432, -0.008601710, -0.041479086, 0.041831065, -0.064874474, -0.000225391, 0.033702626, -0.026852568, 0.071035785, 0.037448083, -0.051060737, 0.039675683, 0.021293653, 0.041344029, 0.005488643, -0.026605899, -0.053144205, -0.009513968, 0.046604346, 0.068903525, -0.020049641, 0.009304000, 0.019805555, -0.029580444, -0.029189439, 0.007143714, 0.008812238)

  expect_warning(out <- IA(X), "This algorithm works for stationary time series with zero-mean.\nFor any other time series, the results may be incorrect.")
  expect_equal(out$nu, expected_nu, tolerance = 1e-6)
  expect_equal(out$coeffs, expected_coeffs, tolerance = 1e-6)
})

test_that("Specify a Maximum Lag `q`", {
  set.seed(456)
  X <- rnorm(50)

  expected_nu <- c(1.093871, 1.089860, 1.089749, 1.088883, 1.075051, 1.074858, 1.073178, 1.047136, 1.019562, 1.015889)

  expected_coeffs <- c(0.107842841, -0.028194840, 0.055568229, -0.130441608, 0.009838843, -0.045904750, 0.149146835, -0.122966296, 0.022835186)

  expect_warning(out <- IA(X, max_lag = 10), "This algorithm works for stationary time series with zero-mean.\nFor any other time series, the results may be incorrect.")
  expect_equal(out$nu, expected_nu, tolerance = 1e-6)
  expect_equal(out$coeffs, expected_coeffs, tolerance = 1e-6)
})

test_that("Check the Theta Matrix", {
  set.seed(789)
  X <- rnorm(30)

  theta_vec <- c(0.000000000, 0.00000000, 0.000000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.00000000, 0.000000000, 0.000000000, 0.0000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.0000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, -0.421653095, 0.00000000, 0.000000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.00000000, 0.000000000, 0.000000000, 0.0000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.0000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, 0.102691003, -0.46016678, 0.000000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.00000000, 0.000000000, 0.000000000, 0.0000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.0000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, -0.141516122, 0.05232284, -0.475040925, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.00000000, 0.000000000, 0.000000000, 0.0000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.0000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, -0.084725298, -0.21556670, 0.036587028, -0.51679997, 0.00000000, 0.0000000, 0.00000000, 0.00000000, 0.000000000, 0.000000000, 0.0000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.0000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, 0.230279330, 0.01504812, -0.195585241, 0.07417783, -0.48981442, 0.0000000, 0.00000000, 0.00000000, 0.000000000, 0.000000000, 0.0000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.0000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, -0.259917953, 0.14678040, -0.003065239, -0.23408600, 0.01450322, -0.4705365, 0.00000000, 0.00000000, 0.000000000, 0.000000000, 0.0000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.0000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, 0.408225668, -0.10677136, 0.181469465, 0.06038100, -0.14361958, -0.0228747, -0.41954813, 0.00000000, 0.000000000, 0.000000000, 0.0000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.0000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, -0.439709320, 0.27100283, -0.137645346, 0.12987001, -0.02234354, -0.1109001, -0.08260550, -0.35640646, 0.000000000, 0.000000000, 0.0000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.0000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, 0.198422504, -0.43303345, 0.274741123, -0.13454855, 0.14423116, -0.0285531, -0.10356598, -0.10162120, -0.359403952, 0.000000000, 0.0000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.0000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, -0.105380272, 0.18728650, -0.439109231, 0.27109802, -0.15015986, 0.1523244, -0.04412269, -0.08662072, -0.121695361, -0.360636127, 0.0000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.0000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, -0.014495300, -0.13560093, 0.182260605, -0.46027528, 0.25450312, -0.1449550, 0.14823859, -0.04109879, -0.093918762, -0.122141758, -0.3669779, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.0000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, 0.131071771, 0.04958780, -0.122743098, 0.21077340, -0.44461272, 0.2508536, -0.14341490, 0.15815037, -0.051845569, -0.094561214, -0.1277872, -0.372819206, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.0000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, -0.222483905, 0.04531787, 0.031272438, -0.15962955, 0.16343451, -0.4299475, 0.23314859, -0.12629894, 0.152023680, -0.052211531, -0.0979962, -0.130897630, -0.37954784, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.0000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, 0.343448717, -0.09446226, 0.073664878, 0.08403919, -0.08192334, 0.1330193, -0.39009152, 0.18708661, -0.093571585, 0.153956752, -0.0389069, -0.088703975, -0.12004703, -0.371934147, 0.000000000, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.0000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, -0.252122129, 0.28841905, -0.107277967, 0.05220080, 0.05377527, -0.0702822, 0.11666973, -0.39592257, 0.202247633, -0.092704721, 0.1614790, -0.033576548, -0.08258084, -0.115169266, -0.381590349, 0.00000000, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.0000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, 0.128698192, -0.24063981, 0.293353818, -0.10116272, 0.06618280, 0.0485754, -0.06335648, 0.11506068, -0.416021102, 0.201112112, -0.1016023, 0.155710447, -0.04116603, -0.090055402, -0.106905674, -0.37686293, 0.000000000, 0.000000000, 0.00000000, 0.000000000, 0.0000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, -0.173576820, 0.06751204, -0.256030182, 0.27315894, -0.14232329, 0.0840040, 0.01816130, -0.01858651, 0.082833778, -0.417971119, 0.1889931, -0.110953411, 0.14496948, -0.051276891, -0.078250361, -0.09578347, -0.383056811, 0.000000000, 0.00000000, 0.000000000, 0.0000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, 0.130526984, -0.14417230, 0.074503317, -0.25020074, 0.30221197, -0.1559730, 0.11150786, -0.02561076, 0.018017213, 0.084980587, -0.4063534, 0.198382920, -0.09983050, 0.156071793, -0.065671485, -0.09389201, -0.088492765, -0.369370129, 0.00000000, 0.000000000, 0.0000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, 0.122086005, 0.22136099, -0.125542964, 0.11065070, -0.20688281, 0.2876207, -0.13510644, 0.08650570, -0.005516613, 0.019190940, 0.0940824, -0.401573036, 0.20594002, -0.093511987, 0.149646195, -0.07296023, -0.090606438, -0.080874642, -0.37972119, 0.000000000, 0.0000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, -0.183235589, 0.05451676, 0.208463138, -0.15258403, 0.07285949, -0.1935174, 0.27353377, -0.12325154, 0.081012549, -0.005837579, 0.0170741, 0.092968769, -0.40597478, 0.203172279, -0.090937139, 0.15379645, -0.075117936, -0.098172934, -0.07559881, -0.378449205, 0.0000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, 0.108271736, -0.16733280, 0.058449309, 0.22134389, -0.14161266, 0.0691226, -0.19350625, 0.29648526, -0.149660270, 0.079488259, -0.0167410, 0.009165075, 0.08359623, -0.417082453, 0.219022077, -0.07547978, 0.146725846, -0.096089658, -0.08214184, -0.061181397, -0.3804048, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, -0.178520229, 0.04013352, -0.183625074, 0.03020373, 0.18931386, -0.1299071, 0.05043812, -0.17898359, 0.300092412, -0.149476270, 0.0814955, -0.015348169, 0.01100548, 0.085801299, -0.423821646, 0.21424779, -0.073359384, 0.155155854, -0.10404895, -0.090471211, -0.0600982, -0.37633821, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, 0.168904542, -0.13050350, 0.050960207, -0.16879908, 0.05732001, 0.1801815, -0.11796832, 0.03501112, -0.175438507, 0.300351331, -0.1489441, 0.082264074, -0.01448440, 0.011866095, 0.085541598, -0.42831503, 0.216890813, -0.067268596, 0.15191565, -0.108130852, -0.0899505, -0.05526448, -0.37746869, 0.00000000, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, -0.037085731, 0.18640916, -0.127777636, 0.05734055, -0.16992596, 0.0584295, 0.18443976, -0.13488779, 0.051449134, -0.174511548, 0.3095857, -0.142870654, 0.09060343, -0.006921052, 0.002506182, 0.07673086, -0.425057765, 0.229694074, -0.07847754, 0.142804449, -0.1069529, -0.07793693, -0.05743837, -0.38154877, 0.00000000, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, 0.022548172, -0.03354164, 0.188751640, -0.12696835, 0.06274074, -0.1740696, 0.06792239, 0.18429384, -0.142080866, 0.051039086, -0.1789618, 0.307763657, -0.14625089, 0.088060930, -0.003802582, 0.00575079, 0.075347548, -0.436234145, 0.24138995, -0.068187218, 0.1414775, -0.12536973, -0.07472186, -0.05249614, -0.37367276, 0.00000000, 0.0000000, 0.00000000, 0.000000, 0, 0.013645109, 0.03442152, -0.031230147, 0.19812662, -0.12010318, 0.0605945, -0.17624826, 0.07721415, 0.186308709, -0.141988299, 0.0521458, -0.178982448, 0.31002482, -0.145078941, 0.087432829, -0.00448896, 0.006093315, 0.077599514, -0.44294987, 0.237402723, -0.0676752, 0.15093345, -0.12713995, -0.07763166, -0.05976380, -0.37002626, 0.0000000, 0.00000000, 0.000000, 0, -0.148066874, -0.05933743, 0.018768413, -0.06074807, 0.16231774, -0.1065886, 0.03835545, -0.15442222, 0.062648957, 0.185492749, -0.1490431, 0.047219402, -0.18658114, 0.304966019, -0.140126306, 0.09341777, -0.007371957, -0.001824771, 0.08493401, -0.440350244, 0.2371011, -0.07287809, 0.15196667, -0.12574444, -0.07512202, -0.06227681, -0.3693817, 0.00000000, 0.000000, 0, 0.047358722, -0.15579734, -0.061525326, 0.01527275, -0.07091620, 0.1683547, -0.12116427, 0.06558151, -0.186195167, 0.060808969, 0.1740201, -0.158141092, 0.03599415, -0.198034305, 0.322219269, -0.12371036, 0.085750031, -0.028837723, 0.01568686, 0.102322372, -0.4427062, 0.21441335, -0.06890071, 0.15847628, -0.11179399, -0.08738390, -0.0556113, -0.37158977, 0.000000, 0, 0.006310183, 0.06083545, -0.154164155, -0.06021029, 0.01856435, -0.0730762, 0.17809162, -0.14737504, 0.091661902, -0.184708371, 0.0719277, 0.182974825, -0.14792248, 0.045593723, -0.211946220, 0.31106841, -0.118638618, 0.101342336, -0.04189500, 0.003494813, 0.1039398, -0.43369401, 0.21296740, -0.07129146, 0.15441868, -0.10911506, -0.0890441, -0.05509181, -0.374892, 0)

  expected_theta <- matrix(theta_vec, byrow = TRUE, ncol = 30)

  expected_nu <- c(0.4854739, 0.3991609, 0.3958307, 0.3853340, 0.3599947, 0.3560081, 0.3440607, 0.3174065, 0.3010716, 0.3010190, 0.2984013, 0.2970212, 0.2948299, 0.2930206, 0.2902527, 0.2873877, 0.2867370, 0.2818783, 0.2787621, 0.2760603, 0.2760143, 0.2696906, 0.2694960, 0.2690188, 0.2664893, 0.2647313, 0.2641977, 0.2641432, 0.2578948, 0.2577759)

  expected_coeffs <- c(-0.374892000, -0.055091812, -0.089044103, -0.109115057, 0.154418680, -0.071291456, 0.212967400, -0.433694014, 0.103939814, 0.003494813, -0.041895002, 0.101342336, -0.118638618, 0.311068412, -0.211946220, 0.045593723, -0.147922484, 0.182974825, 0.071927728, -0.184708371, 0.091661902, -0.147375040, 0.178091615, -0.073076220, 0.018564352, -0.060210290, -0.154164155, 0.060835445, 0.006310183)

  expect_warning(out <- IA(X), "This algorithm works for stationary time series with zero-mean.\nFor any other time series, the results may be incorrect.")
  expect_equal(out$theta, expected_theta, tolerance = 1e-6)
  expect_equal(out$nu, expected_nu, tolerance = 1e-6)
  expect_equal(out$coeffs, expected_coeffs, tolerance = 1e-6)
})

test_that("Time Series with Trend", {
  set.seed(101)
  X <- 1:100 + rnorm(100)


  expected_nu <- c(838.01041, 50.40618, 50.40609, 50.31825, 50.30634, 50.30272, 50.28656, 50.28154, 50.24897, 50.24708, 50.15067, 50.14699, 50.12277, 50.12275, 50.07552, 50.07117, 50.06647, 50.01463, 50.00675, 49.94592, 49.86992, 49.85286, 49.85282, 49.83370, 49.76489, 49.75402, 49.72461, 49.70764, 49.66556, 49.65386, 49.64259, 49.64114, 49.60016, 49.60004, 49.50293, 49.49983, 49.45016, 49.44785, 49.44771, 49.40119, 49.39823, 49.38938, 49.35770, 49.24330, 49.23721, 49.23394, 49.22376, 49.22306, 49.13575, 49.13455, 49.12568, 49.12098, 49.11087, 49.11085, 48.98837, 48.97775, 48.96360, 48.96212, 48.95177, 48.89828, 48.84770, 48.84764, 48.84662, 48.80260, 48.80211, 48.79910, 48.75955, 48.75147, 48.72377, 48.72145, 48.72051, 48.71499, 48.71498, 48.71488, 48.68077, 48.67958, 48.66778, 48.59611, 48.55508, 48.54853, 48.54718, 48.43579, 48.43050, 48.41176, 48.39526, 48.39505, 48.36115, 48.31770, 48.31531, 48.25027, 48.24438, 48.21257, 48.21128, 48.17703, 48.16742, 48.11574, 48.07665, 48.01750, 47.85364, 47.83492)

  expected_coeffs <- c(0.962560915, 0.953283158, 0.892911983, 0.857428829, 0.832456183, 0.796748870, 0.783870324, 0.747189147, 0.746688462, 0.711286400, 0.703007567, 0.651471237, 0.655998246, 0.622995613, 0.577767050, 0.574216467, 0.537762894, 0.536065644, 0.548591557, 0.488218500, 0.461728267, 0.431560406, 0.448760763, 0.390657619, 0.387615678, 0.356699802, 0.361151219, 0.341304091, 0.326313736, 0.290226603, 0.280175945, 0.249201252, 0.264222766, 0.216114273, 0.226471059, 0.203231086, 0.164387780, 0.172231096, 0.153086524, 0.124727146, 0.120499945, 0.142119387, 0.100459267, 0.084534574, 0.077527012, 0.034060920, 0.056262447, 0.032178156, 0.022051111, 0.005734850, -0.001981690, -0.034524692, -0.004733516, -0.043435448, -0.044506568, -0.059692012, -0.102553011, -0.087592672, -0.083332032, -0.096219771, -0.117015948, -0.105606536, -0.126675012, -0.153646759, -0.140255289, -0.178265623, -0.161407740, -0.180997364, -0.177680311, -0.205000606, -0.215358996, -0.231127236, -0.224290916, -0.237687946, -0.224439865, -0.276737540, -0.259398544, -0.268626644, -0.272016197, -0.326370636, -0.322643860, -0.308087998, -0.332834910, -0.315105615, -0.345991188, -0.367430554, -0.357957279, -0.384432562, -0.388129242, -0.414464741, -0.398342857, -0.420153827, -0.418903169, -0.437184166, -0.443239635, -0.446189105, -0.495310913, -0.480881796, -0.028947751)

  expect_warning(out <- IA(X), "This algorithm works for stationary time series with zero-mean.\nFor any other time series, the results may be incorrect.")
  expect_equal(out$nu, expected_nu, tolerance = 1e-6)
  expect_equal(out$coeffs, expected_coeffs, tolerance = 1e-6)
})

test_that("Short Time Series", {
  set.seed(202)
  X <- rnorm(10)

  expected_nu <- c(0.5112452, 0.5067749, 0.5016748, 0.4479049, 0.4253444, 0.4227931, 0.4037794, 0.4008670, 0.3991881, 0.3868445)

  expected_coeffs <- c(-0.23088608, -0.18149611, -0.37103524, -0.05012469, 0.06048621, -0.04411553, 0.21307827, -0.06384881, -0.10828997)

  expect_warning(out <- IA(X), "This algorithm works for stationary time series with zero-mean.\nFor any other time series, the results may be incorrect.")
  expect_equal(out$nu, expected_nu, tolerance = 1e-6)
  expect_equal(out$coeffs, expected_coeffs, tolerance = 1e-6)
})

test_that("AR(1) Time Series", {
  set.seed(303)
  X <- arima.sim(model = list(ar = 0.8), n = 100)

  expected_nu <- c(2.6465254, 1.1024779, 1.1023038, 1.0958755, 1.0836607, 1.0748972, 1.0433830, 1.0420802, 1.0419027, 1.0399322, 1.0288063, 1.0287471, 1.0280048, 1.0027040, 0.9979878, 0.9973857, 0.9823866, 0.9820557, 0.9807940, 0.9636844, 0.9619548, 0.9609065, 0.9608285, 0.9500656, 0.9402396, 0.9372792, 0.9274596, 0.9147508, 0.9076974, 0.9004790, 0.8995008, 0.8990688, 0.8936171, 0.8780262, 0.8710159, 0.8708298, 0.8676989, 0.8579286, 0.8459485, 0.8458511, 0.8443044, 0.8436416, 0.8430467, 0.8430370, 0.8409510, 0.8375296, 0.8374993, 0.8346554, 0.8341381, 0.8338703, 0.8281438, 0.8257599, 0.8257584, 0.8230999, 0.8206594, 0.8191443, 0.8087960, 0.8073308, 0.8070021, 0.7928179, 0.7891392, 0.7881873, 0.7879823, 0.7872997, 0.7821827, 0.7814092, 0.7812976, 0.7810162, 0.7738203, 0.7699798, 0.7696997, 0.7574049, 0.7574026, 0.7546820, 0.7546405, 0.7544926, 0.7514937, 0.7514937, 0.7505657, 0.7496234, 0.7478021, 0.7477033, 0.7462759, 0.7456568, 0.7397881, 0.7394690, 0.7394665, 0.7380605, 0.7376549, 0.7371846, 0.7350687, 0.7350527, 0.7348609, 0.7346237, 0.7343336, 0.7340095, 0.7327031, 0.7312388, 0.7305025, 0.7287415)

  expected_coeffs <- c(0.7144073340, 0.4756573917, 0.2880066873, 0.2592731927, 0.4032241813, 0.2175407826, 0.0704650687, 0.0536634089, 0.1414700772, 0.0715855444, 0.0132637803, 0.0613206174, -0.0589264150, -0.1074637319, -0.1402921891, -0.1979378227, -0.2079696811, -0.1795137776, -0.2422103888, -0.2482064482, -0.3065510386, -0.4005119891, -0.1982476409, -0.1828638074, -0.1834417885, -0.2288993835, -0.3792348111, -0.3480550534, -0.2625755295, -0.1166748655, -0.0743149127, -0.0278791340, -0.0144082266, -0.1077698475, -0.1591566257, -0.0545419575, -0.1718574857, -0.0292734663, -0.0374868207, -0.0007674317, 0.1302340064, 0.0570085674, 0.1107970743, 0.1048608414, 0.0438839475, 0.0568753728, 0.0292090481, 0.1446495121, 0.1497920806, 0.0032162959, 0.0160621749, -0.0260455954, 0.1197426008, 0.1843530993, 0.1728196950, 0.0934652960, -0.0176744053, 0.0859890885, 0.0011779518, -0.0075658051, -0.0254551038, 0.0036278241, 0.0073930392, 0.0361291591, 0.0190181750, 0.0857326790, 0.1664439863, 0.0464605992, -0.0091950604, 0.0302131006, -0.0268126102, -0.0257080956, -0.0669919437, -0.0639039337, -0.0684894930, -0.0899484123, -0.0868372958, -0.0546012081, 0.0067357287, -0.0192097028, -0.0088098860, -0.0858906787, -0.0021236421, 0.0741519876, 0.0652698891, 0.0418874278, 0.0436962167, -0.0092235251, -0.0113175546, -0.0037995379, -0.0251593572, -0.0343302647, -0.0055382567, 0.0020537652, -0.0190258041, -0.0288997405, 0.0067332011, 0.0362189961, 0.0117241591)

  expect_warning(out <- IA(X), "This algorithm works for stationary time series with zero-mean.\nFor any other time series, the results may be incorrect.")
  expect_equal(out$nu, expected_nu, tolerance = 1e-6)
  expect_equal(out$coeffs, expected_coeffs, tolerance = 1e-6)
})

# Conditions for X
test_that("IA: X must be an atomic vector", {
  X <- NULL
  expect_error(IA(X), "X must be an atomic vector")

  X <- list(1, 2, 3)
  expect_error(IA(X), "X must be an atomic vector")

  X <- c(list(1, 2, 3))
  expect_error(IA(X), "X must be an atomic vector")

  X <- function(x) 2 * x + 1
  expect_error(IA(X), "X must be an atomic vector")

  X <- expression(c(2, 4, 5, 7))
  expect_error(IA(X), "X must be an atomic vector")

  X <- data.frame(x = rnorm(100, 0, 1), y = rnorm(100, 0, 1))
  expect_error(IA(X), "X must be an atomic vector")
})

test_that("IA: X must have more than one value", {
  X <- ""
  expect_error(IA(X), "X must have more than one value")

  X <- integer(1)
  expect_error(IA(X), "X must have more than one value")

  X <- double(1)
  expect_error(IA(X), "X must have more than one value")

  X <- numeric(1)
  expect_error(IA(X), "X must have more than one value")

  X <- complex(1)
  expect_error(IA(X), "X must have more than one value")
})

test_that("IA: X may not contain NAs", {
  X <- c(NA, NA, NA)
  expect_error(IA(X), "X may not contain NAs")

  X <- c(NaN, NaN, NaN)
  expect_error(IA(X), "X may not contain NAs")

  X <- c(NA_integer_, NA_integer_, NA_integer_)
  expect_error(IA(X), "X may not contain NAs")

  X <- c(NA_real_, NA_real_, NA_real_)
  expect_error(IA(X), "X may not contain NAs")

  X <- c(NA_complex_, NA_complex_, NA_complex_)
  expect_error(IA(X), "X may not contain NAs")

  X <- c(1, 2, NA, 4, 5)
  expect_error(IA(X), "X may not contain NAs")

  X <- c(1, NA, NaN, NA_real_, 5)
  expect_error(IA(X), "X may not contain NAs")

  X <- c(NULL, NA, Inf, 2)
  expect_error(IA(X), "X may not contain NAs")
})

test_that("IA: X may not contain Inf or -Inf values", {
  X <- c(1, 2, Inf)
  expect_error(IA(X), "X may not contain Inf or -Inf values")

  X <- c(0, -Inf, 2)
  expect_error(IA(X), "X may not contain Inf or -Inf values")

  X <- c(NULL, Inf, -Inf, 4, 5)
  expect_error(IA(X), "X may not contain Inf or -Inf values")
})

test_that("IA: X must only contain numeric or complex values", {
  X <- c(TRUE, FALSE, FALSE)
  expect_error(IA(X), "X must only contain numeric or complex values")

  X <- c(1, "", 2)
  expect_error(IA(X), "X must only contain numeric or complex values")

  X <- c(1, 2, "asdf")
  expect_error(IA(X), "X must only contain numeric or complex values")

  X <- c(1, "42", 2)
  expect_error(IA(X), "X must only contain numeric or complex values")

  X <- c("a", "b", "c")
  expect_error(IA(X), "X must only contain numeric or complex values")

  X <- c(1L, 2, TRUE, "42", 5)
  expect_error(IA(X), "X must only contain numeric or complex values")

  X <- c(-pi, -0.1, "0", 1, 2)
  expect_error(IA(X), "X must only contain numeric or complex values")

  X <- c(1:100, "101", 0)
  expect_error(IA(X), "X must only contain numeric or complex values")

  X <- raw(3)
  expect_error(IA(X), "X must only contain numeric or complex values")
})

# Conditions for max_lag
test_that("max_lag cannot be smaller than 2", {
  set.seed(45)
  X <- rnorm(100, mean = 0, sd = 1)

  max_lag <- 0
  expect_error(IA(X, max_lag), "max_lag cannot be smaller than 2")

  max_lag <- 1
  expect_error(IA(X, max_lag), "max_lag cannot be smaller than 2")
})

test_that("max_lag may not be NA", {
  set.seed(46)
  X <- rnorm(100, mean = 0, sd = 1)

  max_lag <- NA
  expect_error(IA(X, max_lag), "max_lag may not be NA")

  max_lag <- NaN
  expect_error(IA(X, max_lag), "max_lag may not be NA")

  max_lag <- NA_integer_
  expect_error(IA(X, max_lag), "max_lag may not be NA")

  max_lag <- NA_complex_
  expect_error(IA(X, max_lag), "max_lag may not be NA")

  max_lag <- NA_character_
  expect_error(IA(X, max_lag), "max_lag may not be NA")
})

test_that("max_lag may not be an Inf or -Inf value", {
  set.seed(47)
  X <- rnorm(100, mean = 0, sd = 1)

  max_lag <- Inf
  expect_error(IA(X, max_lag), "max_lag may not be an Inf or -Inf value")

  max_lag <- -Inf
  expect_error(IA(X, max_lag), "max_lag may not be an Inf or -Inf value")
})

test_that("IA: max_lag must be numeric", {
  set.seed(42)
  X <- rnorm(100, mean = 0, sd = 1)

  max_lag <- TRUE
  expect_error(IA(X, max_lag), "max_lag must be numeric")

  max_lag <- F
  expect_error(IA(X, max_lag), "max_lag must be numeric")

  max_lag <- ""
  expect_error(IA(X, max_lag), "max_lag must be numeric")

  max_lag <- "pi"
  expect_error(IA(X, max_lag), "max_lag must be numeric")

  max_lag <- "42"
  expect_error(IA(X, max_lag), "max_lag must be numeric")

  max_lag <- 0i
  expect_error(IA(X, max_lag), "max_lag must be numeric")

  max_lag <- 1i
  expect_error(IA(X, max_lag), "max_lag must be numeric")

  max_lag <- 2 + 5i
  expect_error(IA(X, max_lag), "max_lag must be numeric")

  max_lag <- raw(1)
  expect_error(IA(X, max_lag), "max_lag must be numeric")
})

test_that("IA: max_lag must be an integer", {
  set.seed(43)
  X <- rnorm(100, mean = 0, sd = 1)

  max_lag <- 2.5
  expect_error(IA(X, max_lag), "max_lag must be an integer")

  max_lag <- .Machine$double.eps
  expect_error(IA(X, max_lag), "max_lag must be an integer")

  max_lag <- 0.1
  expect_error(IA(X, max_lag), "max_lag must be an integer")

  max_lag <- pi
  expect_error(IA(X, max_lag), "max_lag must be an integer")

  max_lag <- 10e-8
  expect_error(IA(X, max_lag), "max_lag must be an integer")
})

test_that("IA: max_lag cannot exceed length\\(X\\)", {
  set.seed(44)
  X <- rnorm(100, mean = 0, sd = 1)

  max_lag <- 101
  expect_error(IA(X, max_lag), "max_lag cannot exceed length\\(X\\)")

  max_lag <- 102
  expect_error(IA(X, max_lag), "max_lag cannot exceed length\\(X\\)")

  max_lag <- 1001
  expect_error(IA(X, max_lag), "max_lag cannot exceed length\\(X\\)")
})
